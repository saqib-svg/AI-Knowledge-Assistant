<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocAssist AI - Chat</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="brand">
                <i class="fa-solid fa-robot"></i>
                <h1>DocAssist</h1>
            </div>

            <!-- CHATS SECTION -->
            <div class="chats-section">
                <div class="chats-header">
                    <h3>Chats</h3>
                </div>
                <div class="chat-new-form">
                    <input type="text" id="new-chat-title" placeholder="New chat..." maxlength="50" class="chat-title-input">
                    <button id="new-chat-btn" class="btn-create-chat" title="Create new chat">
                        <i class="fa-solid fa-plus"></i> Create
                    </button>
                </div>
                <div id="chat-list" class="chat-list">
                    <div style="padding: 15px; color: #999; font-size: 13px; text-align: center;">No chats yet</div>
                </div>
                <button id="logout-btn" class="btn-logout">
                    <i class="fa-solid fa-sign-out-alt"></i> Logout
                </button>
            </div>

<<<<<<< Updated upstream
            <!-- UPLOAD SECTION REMOVED -->
=======
            <div class="status-card">
                <div class="status-item">
                    <span class="label">Status</span>
                    <span class="value online">Online</span>
                </div>
                <div class="status-item">
                    <span class="label">Model</span>
                    <span class="value">Gemini 2.0 Flash</span>
                </div>
            </div>
>>>>>>> Stashed changes
        </aside>

        <!-- MAIN CHAT AREA -->
        <main class="main-area">
            <!-- NO CHAT SELECTED STATE -->
            <div id="no-chat-selected" class="no-chat-selected">
                <i class="fa-solid fa-comments"></i>
                <h2>No chat selected</h2>
                <p>Select a chat from the list or create a new one to get started</p>
            </div>

            <!-- CHAT INTERFACE -->
            <div id="chat-interface" class="chat-interface" style="display: none;">
                <div class="chat-header">
                    <h2 id="chat-title-display">Select a chat</h2>
                    <div class="chat-actions">
                        <!-- Documents will be listed here -->
                        <div id="chat-documents-container" class="chat-documents-container"></div>
                    </div>
                </div>
                
                <div class="messages" id="messages"></div>
                
                <div class="message-input-area">
                    <div class="input-wrapper">
                        <textarea id="message-input" placeholder="Type your message..." rows="1"></textarea>
                        <button id="send-btn" class="send-btn" title="Send message">
                            <i class="fa-solid fa-paper-plane"></i>
                        </button>
                        <button id="file-upload-btn" class="upload-btn" title="Upload files">
                            <i class="fa-solid fa-paperclip"></i>
                        </button>
                        <input type="file" id="file-input" hidden multiple accept=".pdf,.docx">
                    </div>
                    <p class="disclaimer">AI can make mistakes. Please verify important information.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Load scripts with proper error handling -->
    <script>
        // First, ensure CONFIG is defined with a default value
        window.CONFIG = window.CONFIG || { API_BASE_URL: 'http://localhost:8000' };
        
        function loadScript(src, callback) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    console.log(`✅ ${src} loaded successfully`);
                    if (callback) callback();
                    resolve();
                };
                script.onerror = (error) => {
                    console.error(`❌ Failed to load script: ${src}`, error);
                    if (src.includes('config.js')) {
                        console.warn('Using default configuration');
                        resolve(); // Continue even if config fails
                    } else {
                        reject(error);
                    }
                };
                document.body.appendChild(script);
            });
        }

        // Load scripts in sequence when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('DOM fully loaded, initializing app...');
            
            try {
                // Try to load config.js first, but don't fail if it doesn't exist
                await loadScript('config.js').catch(() => {});
                
                // Ensure CONFIG has required properties
                window.CONFIG = {
                    API_BASE_URL: window.CONFIG?.API_BASE_URL || 'http://localhost:8000',
                    // Add other default config values here
                    ...window.CONFIG
                };
                
                console.log('Using API base URL:', window.CONFIG.API_BASE_URL);
                
                // Now load the main script
                await loadScript('script.js');
                console.log('✅ All scripts loaded successfully');
                
                // Expose functions to window for debugging
                window.debug = {
                    logout: window.logout,
                    createChat: window.createChat,
                    CONFIG: window.CONFIG
                };
                
            } catch (error) {
                console.error('❌ Error loading scripts:', error);
                alert('Failed to load application. Please check the console for errors.');
            }
        });
        
        // Fallback in case DOMContentLoaded already fired
        if (document.readyState === 'interactive' || document.readyState === 'complete') {
            document.dispatchEvent(new Event('DOMContentLoaded'));
        }
    </script>
</body>
</html>